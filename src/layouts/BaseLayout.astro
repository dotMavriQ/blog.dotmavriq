---
// Background visuals temporarily removed for 1:1 minimal clone
// Dark layout with retro road grid animation (enhanced)
import RoadGrid from '../components/RoadGrid.astro';
import RoadPerspective from '../components/RoadPerspective.astro';
import ParticleBackground from '../components/ParticleBackground.astro';
import ShakeDetector from '../components/ShakeDetector.astro';
import siteLogo from '../assets/portfolio/dotmavriqlogo.png';

const pathname = Astro.url.pathname;
const isHome = pathname === '/';
const isContact = pathname.startsWith('/contact');
const isActive = (p: string) => pathname === p || (p !== '/' && pathname.startsWith(p));

export interface Props { title?: string; description?: string; }
const { title = 'blog.dotMavriQ', description = 'Personal blog of Jonatan Jansson (dotMavriQ)' } = Astro.props as Props;
const canonicalURL = new URL(pathname, 'https://blog.dotmavriq.life').href;
---
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title}</title>
  <link rel="icon" href="/favicon.ico" sizes="48x48" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <meta name="description" content={description} />
  <meta name="color-scheme" content="dark" />
  <link rel="canonical" href={canonicalURL} />
  <!-- Open Graph -->
  <meta property="og:site_name" content="blog.dotMavriQ" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:image" content="/logo.png" />
  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content="/logo.png" />
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" />
    <meta name="theme-color" content="#1d2021" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <!-- 2025 font pairing: Inter (UI/body) + JetBrains Mono (code/meta) â€” loaded async to unblock render -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'" />
  {pathname.startsWith('/contact') && (
    <>
    <link rel="preconnect" href="https://assets.calendly.com" />
    <link rel="preload" as="style" href="https://assets.calendly.com/assets/external/widget.css" />
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet" media="print" onload="this.media='all'" />
    </>
  )}
  <!-- Matomo -->
  <script is:inline>
    var _paq = window._paq = window._paq || [];
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://blogdotmavriqlife.matomo.cloud/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src='https://cdn.matomo.cloud/blogdotmavriqlife.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  </head>
  <body class:list={["bg-gruv-bg","text-gruv-fg","font-sans","antialiased","min-h-screen","flex","flex-col","relative","overflow-x-hidden", isHome && 'home-no-scroll']}>
    <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-gruv-surface text-gruv-yellow px-3 py-2 rounded">Skip to content</a>
    <!-- Layered background effects (respect prefers-reduced-motion) -->
    <ParticleBackground />
    {isHome && (
      <>
        <RoadGrid />
        <RoadPerspective />
      </>
    )}
    <ShakeDetector />
    <header class="relative z-40 bg-[#121314]/95 backdrop-blur-sm border-b border-gruv-surface2/70 shadow-lg shadow-black/30">
      <nav aria-label="Primary" class="max-w-6xl mx-auto px-5 lg:px-6 py-3 sm:py-4 flex items-center justify-between gap-3 text-[15px] tracking-tight">
        <a href="/" aria-label="Home" class="group flex items-center gap-3 text-[20px] sm:text-[22px] font-extrabold font-heading text-gruv-yellow focus:outline-none focus:ring-2 focus:ring-gruv-yellow/60 rounded transition-colors">
          <img src={siteLogo.src} width={56} height={56} alt="dotMavriQ logo" class="rounded-sm transition-transform duration-300 group-hover:scale-105" loading="eager" fetchpriority="high" decoding="async" />
          <span class="leading-none">blog.dotMavriQ</span>
        </a>
        <!-- Desktop nav -->
        <div class="hidden md:flex flex-wrap items-center gap-3 ml-auto">
          <a class:list={["nav-chip","nav-orange", isActive('/about') && 'is-active']} aria-current={isActive('/about') ? 'page' : undefined} href="/about">About</a>
          <a class:list={["nav-chip","nav-green", isActive('/cv') && 'is-active']} aria-current={isActive('/cv') ? 'page' : undefined} href="/cv">CV</a>
          <a class:list={["nav-chip","nav-yellow", isActive('/portfolio') && 'is-active']} aria-current={isActive('/portfolio') ? 'page' : undefined} href="/portfolio">Portfolio</a>
          <a class:list={["nav-chip","nav-blue", isActive('/blog') && 'is-active']} aria-current={isActive('/blog') ? 'page' : undefined} href="/blog">Blog</a>
          <a class:list={["nav-chip","nav-red", isActive('/contact') && 'is-active']} aria-current={isActive('/contact') ? 'page' : undefined} href="/contact">Contact</a>
        </div>
        <!-- Mobile toggle -->
  <button id="nav-toggle" class="burger md:hidden ml-auto inline-flex flex-col items-center justify-center w-10 h-10 rounded-md border border-gruv-surface2 bg-[#1c1d1e] text-gruv-fg hover:text-gruv-yellow focus:outline-none focus:ring-2 focus:ring-gruv-yellow/40" aria-label="Toggle menu" aria-controls="mobile-menu" aria-expanded="false">
          <span class="burger-line"></span>
          <span class="burger-line"></span>
          <span class="burger-line"></span>
        </button>
      </nav>
      <!-- Mobile menu panel -->
      <div id="mobile-menu" class="md:hidden max-w-6xl mx-auto px-5 lg:px-6 pb-3 hidden" role="region" aria-label="Mobile">
        <div class="flex flex-col gap-2">
          <a class:list={["nav-chip","nav-orange","w-full", isActive('/about') && 'is-active']} aria-current={isActive('/about') ? 'page' : undefined} href="/about">About</a>
          <a class:list={["nav-chip","nav-green","w-full", isActive('/cv') && 'is-active']} aria-current={isActive('/cv') ? 'page' : undefined} href="/cv">CV</a>
          <a class:list={["nav-chip","nav-yellow","w-full", isActive('/portfolio') && 'is-active']} aria-current={isActive('/portfolio') ? 'page' : undefined} href="/portfolio">Portfolio</a>
          <a class:list={["nav-chip","nav-blue","w-full", isActive('/blog') && 'is-active']} aria-current={isActive('/blog') ? 'page' : undefined} href="/blog">Blog</a>
          <a class:list={["nav-chip","nav-red","w-full", isActive('/contact') && 'is-active']} aria-current={isActive('/contact') ? 'page' : undefined} href="/contact">Contact</a>
        </div>
      </div>
    </header>
  <main id="main" class:list={["flex-1","w-full","relative","z-20"]}>
      <slot />
    </main>
    <footer class:list={[
      (isHome ? 'fixed bottom-0 left-0 right-0 overlay-footer' : 'relative'),
      'z-50','bg-[#121314]/92','backdrop-blur-[2px]','border-t','border-gruv-surface2/70','shadow-inner','shadow-black/40',
      (isHome ? 'mt-0' : 'mt-10')
    ]}>
  <div class:list={["px-6", isHome ? 'py-3' : 'py-5', "text-[11px]","md:text-xs","text-gruv-muted","font-mono","tracking-tight","w-full","max-w-6xl","mx-auto","flex","items-center","justify-center"]}>
        <span class="whitespace-nowrap">ðŸ„¯ {new Date().getFullYear()} dotMavriQ Â· All base are belong to us.</span>
      </div>
    </footer>
  </body>
</html>
<style>
  :root { --font-ui:'Inter',system-ui,sans-serif; --font-mono:'JetBrains Mono','Fira Code',monospace; }
  .font-heading{ font-family:var(--font-ui); letter-spacing:-0.5px; }
  body{ font-family:var(--font-ui); }
  code,pre,.font-mono{ font-family:var(--font-mono); }
  .nav-chip { @apply relative px-3 py-2 rounded-md font-medium text-gruv-fg/90 bg-[#1c1d1e] border border-[#242628] shadow-sm hover:shadow-md focus:shadow-md focus:outline-none focus:ring-2 focus:ring-gruv-yellow/40; transition: background-color .15s ease, color .15s ease, border-color .15s ease, box-shadow .15s ease, transform .15s ease; }
  .nav-chip:hover,.nav-chip:focus { @apply border-gruv-surface2 translate-y-[-1px]; }
  .nav-chip.is-active { @apply bg-gruv-yellow text-gruv-bg border-gruv-yellow shadow-md; }
  .nav-chip.is-active.nav-blue { @apply bg-gruv-blue; }
  .nav-chip.is-active.nav-green { @apply bg-gruv-green; }
  .nav-chip.is-active.nav-orange { @apply bg-gruv-orange; }
  .nav-chip.is-active.nav-red { @apply bg-gruv-red; }
  .nav-chip.is-active.nav-yellow { @apply bg-gruv-yellow; }
  .nav-blue:hover,.nav-blue:focus { @apply text-gruv-bg bg-gruv-blue; }
  .nav-orange:hover,.nav-orange:focus { @apply text-gruv-bg bg-gruv-orange; }
  .nav-green:hover,.nav-green:focus { @apply text-gruv-bg bg-gruv-green; }
  .nav-yellow:hover,.nav-yellow:focus { @apply text-gruv-bg bg-gruv-yellow; }
  .nav-red:hover,.nav-red:focus { @apply text-gruv-bg bg-gruv-red; }
  @media (max-width:640px){ .nav-chip{ @apply px-2 py-1 text-[13px]; } }
  /* Removed extended footer navigation styles */
  /* Home: lock scroll so the fixed footer overlays without page scroll */
  body.home-no-scroll{ overflow:hidden; }
  /* When mobile menu is open, prevent background scroll */
  body.menu-open{ overflow:hidden; }
  /* Overlay footer: respect safe-area so it's not too low on mobile */
  .overlay-footer{ bottom: max(env(safe-area-inset-bottom), 0px); }
  /* Use flex column layout to push footer to the bottom without scroll on home */
  /* Burger button */
  .burger{ position:relative; gap:4px; }
  .burger-line{ display:block; width:22px; height:2px; background:currentColor; border-radius:2px; transition: transform .18s ease, opacity .18s ease, background-color .18s ease; }
  .burger[aria-expanded="true"] .burger-line:nth-child(1){ transform: translateY(6px) rotate(45deg); }
  .burger[aria-expanded="true"] .burger-line:nth-child(2){ opacity:0; }
  .burger[aria-expanded="true"] .burger-line:nth-child(3){ transform: translateY(-6px) rotate(-45deg); }
  .burger:hover .burger-line{ background-color: currentColor; }
</style>

<script is:inline>
  const toggle = document.getElementById('nav-toggle');
  const panel = document.getElementById('mobile-menu');
  toggle?.addEventListener('click', () => {
  const isHidden = panel?.classList.toggle('hidden');
  const open = isHidden === false; // hidden removed => open
  toggle?.setAttribute('aria-expanded', String(open));
    document.body.classList.toggle('menu-open', open);
  });
</script>
