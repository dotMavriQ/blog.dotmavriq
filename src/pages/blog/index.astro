---
import Base from "../../layouts/BaseLayout.astro";
import Card from "../../components/Card.astro";
import { getCollection } from 'astro:content';

// Fetch posts from the blog collection
const blogEntries = await getCollection('blog');

// Transform the data for our component
const posts = blogEntries.map(entry => ({
  title: entry.data.title,
  excerpt: entry.data.excerpt,
  date: new Date(entry.data.date),
  url: `/blog/${entry.slug}`,
  img: `/blog/${entry.slug.replace(/\.[^/.]+$/, "")}-thumb.jpg`
}));

// Sort by date (newest first)
posts.sort((a, b) => b.date.getTime() - a.date.getTime());
---
<Base title="Blog – Jonatan">
  <header class="text-center py-lg mb-lg">
    <h1 class="text-3xl mb-md">Blog</h1>
    <p class="text-lg max-w-[600px] mx-auto mb-md">Thoughts, tutorials, and insights on web development, music, and life in Portugal.</p>
  </header>

  <div class="grid md:grid-cols-2 gap-lg">
    {posts.map(post => (
      <Card
        title={post.title}
        img={post.img}
        excerpt={post.excerpt}
        href={post.url}
        cta="Read Article →"
      />
    ))}
  </div>
</Base>
